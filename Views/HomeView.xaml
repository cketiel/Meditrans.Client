<UserControl x:Class="Meditrans.Client.Views.HomeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Meditrans.Client.Views"
             xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"  
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/shared"
             xmlns:domain="clr-namespace:Meditrans.Client.Validations"
             xmlns:vm="clr-namespace:Meditrans.Client.ViewModels"
             xmlns:helpers="clr-namespace:Meditrans.Client.Helpers" 
             xmlns:converters="clr-namespace:Meditrans.Client.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">

    
    
    <UserControl.Resources>
        <!-- vmProxy “captures” the current DataContext (HomeViewModel) -->
        <helpers:BindingProxy x:Key="vmProxy" Data="{Binding}" />
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
        <helpers:MinutesToTimeStringConverter x:Key="MinutesConverter" />
        <converters:StatusToVisibilityConverter x:Key="StatusToVisibilityConverter" />

        <Style x:Key="HomeTripRowStyle" TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
            <Setter Property="Background" Value="{StaticResource EvenRowBackgroundBrush}"/>
            <Style.Triggers>

                <DataTrigger Binding="{Binding Status}" Value="Canceled">
                    <Setter Property="Foreground" Value="Red" />
                    <Setter Property="ToolTip" Value="Canceled: Driver No-Show reported." />
                </DataTrigger>

                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition Binding="{Binding Status}" Value="Canceled" />
                        <Condition Binding="{Binding DriverNoShowReason, TargetNullValue={x:Null}}" Value="{x:Null}" />
                    </MultiDataTrigger.Conditions>
                    <Setter Property="Foreground" Value="Gray" />
                    <Setter Property="FontStyle" Value="Italic" />
                    <Setter Property="ToolTip" Value="This trip was canceled by the office." />
                </MultiDataTrigger>

                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition Binding="{Binding Status}" Value="Canceled" />
                        <Condition Binding="{Binding DriverNoShowReason}" Value="" />
                    </MultiDataTrigger.Conditions>
                    <Setter Property="Foreground" Value="Gray" />
                    <Setter Property="ToolTip" Value="This trip was canceled by the office." />
                </MultiDataTrigger>
            </Style.Triggers>
        </Style>
        
    </UserControl.Resources>

    <materialDesign:DialogHost Identifier="RootDialogHost">
        
    <Border BorderThickness="0,1,0,0" BorderBrush="{StaticResource MainBorderBrush}">

            <Grid Margin="5" Background="Transparent">
                <Grid.RowDefinitions>
                    <RowDefinition x:Name="TopRow" Height="4.5*" /> <!-- 45% Upper area -->
                    <RowDefinition Height="6" />  <!-- Horizontal GridSplitter -->
                    <RowDefinition x:Name="BottomRow" Height="5.5*" /> <!-- 55% Lower area (DataGrid) -->
                </Grid.RowDefinitions>

                <!-- Top row: Client, Billing, Splitter, Map -->
                <Grid Grid.Row="0" x:Name="GridRow0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition x:Name="CustomerColumn" Width="1*" />  <!-- Customer and Trip data area (initially hidden) -->
                        <ColumnDefinition Width="6" />     <!-- Vertical GridSplitter -->
                        <ColumnDefinition x:Name="BillingColumn" Width="0" />  <!-- Billing (initially hidden) -->
                        <ColumnDefinition Width="6" />     <!-- Vertical GridSplitter -->
                        <ColumnDefinition x:Name="MapColumn" Width="2*" />    <!-- Map -->
                    </Grid.ColumnDefinitions>

                    <!-- Customer data area -->
                <Grid Grid.Column="0"  Background="Transparent">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto"/>

                        </Grid.RowDefinitions>

                        <!-- 👤 Customer Search & Info -->

                        <StackPanel Grid.Row="0" Background="Transparent">

                            <!-- 🔎 Customer Search Section -->

                            <StackPanel Margin="2" Background="Transparent">

                                <materialDesign:ColorZone Padding="10,3,10,3" Mode="PrimaryMid"
                                                          materialDesign:ElevationAssist.Elevation="Dp1"
                                                          ClipToBounds="False"
                                                          CornerRadius="5">

                                    <DockPanel Margin="0,0,0,0">
                                                <StackPanel materialDesign:RippleAssist.IsCentered="True"
                                                            Orientation="Horizontal">

                                                    <TextBlock 
                                                        Text="Search passenger by: "
                                                        VerticalAlignment="Center">
                                                    
                                                    </TextBlock>

                                                    <materialDesign:ColorZone Margin="5,2,0,2"
                                                                            Padding="8,4,8,4"
                                                                            Panel.ZIndex="1"
                                                                            materialDesign:ElevationAssist.Elevation="Dp2"
                                                                            CornerRadius="2"
                                                                            Mode="Standard" Cursor="">        

                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto" />
                                                                <ColumnDefinition Width="*" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>

                                                            <Button Style="{StaticResource MaterialDesignToolButton}">
                                                                <materialDesign:PackIcon Kind="Search" Opacity=".56" />
                                                            </Button>

                                                            <!-- AutoSuggestBox -->
                                                            <materialDesign:AutoSuggestBox
                                                                x:Name="CustomersAutoSuggestBox"
                                                                Grid.Column="1"
                                                                MinWidth="250"            
                                                                VerticalAlignment="Center"
                                                                Margin="0,0,8,0"
                                                                materialDesign:TextFieldAssist.HasClearButton="True"
                                                                materialDesign:HintAssist.Hint="{Binding AutoSuggestBoxHint}"
                                                                Suggestions="{Binding FilteredCustomers}"
                                                                Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                                    
    
                                                                ValueMember="Id"
                                                                SuggestionChosen="CustomersAutoSuggestBox_SuggestionChosen" TextChanged="CustomersAutoSuggestBox_TextChanged">

                                                                <materialDesign:AutoSuggestBox.ItemTemplate>
                                                                    <DataTemplate>
                                                                        <Border  BorderThickness="0,0,0,1"
                                                                                BorderBrush="#bbdefb"
                                                                   
                                                                                HorizontalAlignment="Stretch"
                                                                                VerticalAlignment="Stretch">
                                                                            <StackPanel Orientation="Vertical">
                                                                                <TextBlock FontWeight="Bold" Text="{Binding FullName}"/>
                                                                                <TextBlock Margin="5 0 0 0" Text="{Binding Address}"/>
                                                                                <StackPanel Margin="5 0 0 0" Orientation="Horizontal">
                                                                                    <TextBlock Text="Phone" Margin="0 0 8 0" FontWeight="Bold"/>
                                                                                    <TextBlock Text="{Binding Phone}"/>
                                                                                </StackPanel>
                                                                                <StackPanel Margin="5 0 0 0" Orientation="Horizontal">
                                                                                    <TextBlock Text="Cient Code" Margin="0 0 8 0" FontWeight="Bold"/>
                                                                                    <TextBlock Text="{Binding ClientCode}"/>
                                                                                </StackPanel>
                                                                            </StackPanel>
                                                                        </Border>
                                                                    </DataTemplate>
                                                                </materialDesign:AutoSuggestBox.ItemTemplate>
                                                            </materialDesign:AutoSuggestBox>

                                                            <Button 
                                                                Grid.Column="2"
                                                                Style="{StaticResource MaterialDesignToolButton}">
                                                            
                                                                <materialDesign:PackIcon
                                                                    Margin="8,0,0,0"
                                                                    Kind="Microphone"
                                                                    Opacity=".56" />
                                                            </Button>

                                                        </Grid>
                                                    </materialDesign:ColorZone>


                                        


                                                <Button
                                                    Margin="50,0,0,0"
                                                
                                                    ToolTip="{Binding SaveCustomerToolTip}"
                                                    Style="{StaticResource MaterialDesignToolForegroundButton}"
                                                    Command="{Binding SaveCustomerCommand}" Click="OnSaveCustomerClick">

                                                    <materialDesign:PackIcon Kind="ContentSave" Width="25" Height="25" />
                                                </Button>

                                            <Button
                                                    Margin="5,0,0,0"
                                                
                                                    ToolTip="{Binding NewCustomerToolTip}"
                                                    Style="{StaticResource MaterialDesignToolForegroundButton}"
                                                    Command="{Binding NewCustomerCommand}" Click="OnNewCustomerClick">

                                                <materialDesign:PackIcon Kind="AccountMultiplePlus" Width="25" Height="25"/>
                                            </Button>

                                        </StackPanel>
                                    </DockPanel>
                                </materialDesign:ColorZone>

                            </StackPanel>

                            <!-- 🧾 Customer Info Section -->
                            <!-- <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" Margin="0">-->                        
                        
                            <StackPanel Margin="2"
                                    Orientation="Vertical" 
                                    Background="{DynamicResource MaterialDesignPaper}" >

                        
                                    <materialDesign:Card Padding="4" Background="{DynamicResource MaterialDesignCardBackground}">
                                        <StackPanel>
                                            
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <!-- Left Column -->
                                                <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                                    <TextBox x:Name="FullNameTextBox"
                                                             Text="{Binding SelectedCustomer.FullName}"
                                                             materialDesign:TextFieldAssist.HasClearButton="True"
                                                     
                                                             materialDesign:HintAssist.Hint="{Binding FullNameTextBoxHint}"
                                                             materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                             materialDesign:TextFieldAssist.LeadingIcon="TextUser"
                                                             Style="{StaticResource MaterialDesignFilledTextBox}" Margin="0,0,0,2">

                                                    <!--<TextBox.Text>
                                                        <Binding Path="SelectedCustomer.FullName" UpdateSourceTrigger="PropertyChanged">
                                                            <Binding.ValidationRules>
                                                                <domain:NotEmptyValidationRule ValidatesOnTargetUpdated="True"/>      
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>-->
                                                        
                                                    </TextBox>
                                                    <TextBox x:Name="ClientCodeTextBox"
                                                             Text="{Binding SelectedCustomer.ClientCode}" 
                                                             materialDesign:HintAssist.Hint="{Binding ClientCodeTextBoxHint}" 
                                                             materialDesign:TextFieldAssist.HasClearButton="True"
                                                             materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                             materialDesign:TextFieldAssist.LeadingIcon="Barcode"
                                                             Style="{StaticResource MaterialDesignFilledTextBox}" Margin="0,0,0,2"/>
                                                    <TextBox x:Name="PhoneTextBox"
                                                                Text="{Binding SelectedCustomer.Phone}" 
                                                                 materialDesign:HintAssist.Hint="{Binding PhoneTextBoxHint}" 
                                                                 materialDesign:TextFieldAssist.HasClearButton="True"
                                                                 materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                                 materialDesign:TextFieldAssist.LeadingIcon="Phone"
                                                                 Style="{StaticResource MaterialDesignFilledTextBox}" Margin="0,0,0,2"/>
                                                    <TextBox x:Name="MobilePhoneTextBox"
                                                                Text="{Binding SelectedCustomer.MobilePhone}" 
                                                                 materialDesign:HintAssist.Hint="{Binding MobilePhoneTextBoxHint}" 
                                                                 materialDesign:TextFieldAssist.HasClearButton="True"
                                                                 materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                                 materialDesign:TextFieldAssist.LeadingIcon="MobilePhone"
                                                                 Style="{StaticResource MaterialDesignFilledTextBox}" Margin="0,0,0,2"/>

                                                    <ComboBox   x:Name="SpaceTypeComboBox"
                                                                ItemsSource="{Binding SpaceTypes}" 
                                                                SelectedItem="{Binding SelectedSpaceType, Mode=TwoWay}" 
                                                                DisplayMemberPath="ShowNameDescription" 
                                                                SelectedValuePath="Id"
                                                                Style="{StaticResource MaterialDesignFilledComboBox}"
                                                                materialDesign:TextFieldAssist.HasClearButton="True"
                                                                materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                                materialDesign:TextFieldAssist.LeadingIcon="HumanWheelchair"
                                                                Margin="0,0,0,2"
                                                                materialDesign:HintAssist.Hint="{Binding SpaceTypeComboBoxHint}" />

                                                    <ComboBox x:Name="FundingSourceComboBox"
                                                            ItemsSource="{Binding FundingSources}" 
                                                            SelectedItem="{Binding SelectedFundingSource, Mode=TwoWay}" 
                                                            DisplayMemberPath="Name" 
                                                            SelectedValuePath="Id"
                                                            Style="{StaticResource MaterialDesignFilledComboBox}"
                                                            materialDesign:TextFieldAssist.HasClearButton="True"
                                                            materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                            materialDesign:TextFieldAssist.LeadingIcon="Finance"
                                                            Margin="0,0,0,2"
                                                            materialDesign:HintAssist.Hint="{Binding FundingSourceComboBoxHint}" />

                                                </StackPanel>

                                                <!-- Right Column -->
                                                <StackPanel Grid.Column="1">

                                                    <Grid>
                                                        
                                                        <Button x:Name="GeolocateFloatingButton" Width="30" Height="30"
                                                                Panel.ZIndex="100"
                                                                Margin="8,6,16,-20"
                                                                HorizontalAlignment="Left"
                                                                VerticalAlignment="Top"
                                                                ToolTip="{Binding GeolocateFloatingButtonToolTip}"
                                                                Style="{StaticResource MaterialDesignFloatingActionMiniButton}" MouseEnter="GeolocateFloatingButton_MouseEnter" MouseLeave="GeolocateFloatingButton_MouseLeave" Click="GeolocateFloatingButton_Click">
                                                            <materialDesign:PackIcon Kind="AddressMarker" />
                                                        </Button>
                                                        
                                                        <TextBox x:Name="GooglePlacesInput" Text="{Binding SelectedCustomer.Address}"
                                                                 materialDesign:HintAssist.Hint="{Binding GooglePlacesInputHint}"
                                                    
                                                                 materialDesign:TextFieldAssist.HasClearButton="True"
                                                                 materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                                 materialDesign:TextFieldAssist.LeadingIcon="AddressMarker"
                                                                 Style="{StaticResource MaterialDesignFilledTextBox}" Margin="0,0,0,2"
                                                                 TextChanged="GooglePlacesInput_TextChanged" />
                                                        
                                                    </Grid>

                                                    <TextBox x:Name="City" Text="{Binding SelectedCustomer.City}" 
                                                                 materialDesign:HintAssist.Hint="{Binding CityHint}" 
                                                                 materialDesign:TextFieldAssist.HasClearButton="True"
                                                                 materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                                 materialDesign:TextFieldAssist.LeadingIcon="City"
                                                                 Style="{StaticResource MaterialDesignFilledTextBox}" Margin="0,0,0,2"/>
                                                    <TextBox x:Name="State" Text="{Binding SelectedCustomer.State}" 
                                                                 materialDesign:HintAssist.Hint="{Binding StateHint}" 
                                                                 materialDesign:TextFieldAssist.HasClearButton="True"
                                                                 materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                                 materialDesign:TextFieldAssist.LeadingIcon="Estate"
                                                                 Style="{StaticResource MaterialDesignFilledTextBox}" Margin="0,0,0,2"/>
                                                    <TextBox x:Name="Zip" Text="{Binding SelectedCustomer.Zip}" 
                                                                 materialDesign:HintAssist.Hint="{Binding ZipHint}" 
                                                                 materialDesign:TextFieldAssist.HasClearButton="True"
                                                                 materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                                 materialDesign:TextFieldAssist.LeadingIcon="EnvelopeBox"
                                                                 Style="{StaticResource MaterialDesignFilledTextBox}" Margin="0,0,0,2"/>


                                                    <DatePicker x:Name="DOBDatePicker" SelectedDate="{Binding SelectedCustomer.DOB}" 
                                                                materialDesign:HintAssist.Hint="{Binding DOBDatePickerHint}" 
                                                                materialDesign:TextFieldAssist.HasClearButton="True"
                                                                materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                                materialDesign:TextFieldAssist.LeadingIcon="CalendarRange"
                                                                Style="{StaticResource MaterialDesignFilledDatePicker}" Margin="0,0,0,2"/>

                                                    <StackPanel 
                                                        Orientation="Horizontal" Margin="0,15,0,0"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center">

                                                        <RadioButton x:Name="MaleRadioButton" Content="{Binding MaleRadioButtonContent}"
                                                                         GroupName="GenderRadioButtonGroup"
                                                                         IsChecked="{Binding GenderMale}" 
                                                                         Style="{StaticResource MaterialDesignRadioButton}" Margin="0,0,10,0"/>
                                                        <RadioButton x:Name="FemaleRadioButton" Content="{Binding FemaleRadioButtonContent}"
                                                                         GroupName="GenderRadioButtonGroup"
                                                                         IsChecked="{Binding GenderFemale}" 
                                                                         Style="{StaticResource MaterialDesignRadioButton}"/>
                                                    </StackPanel>

                                                </StackPanel>

                                            </Grid>

                                        </StackPanel>
                                    </materialDesign:Card>
                        
                            </StackPanel>
                        
                            <!-- </ScrollViewer> -->

                        </StackPanel>
                        
                        
                        <!-- 📅 Trip Filters -->
                        
                        <materialDesign:Card Margin="2"
                            Grid.Row="1"                                             
                            Padding="10" 
                            Background="{DynamicResource MaterialDesignCardBackground}">
                            
                            <StackPanel x:Name="TripFilterPanel">

                                
                                <Grid Margin="5" Background="Transparent">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />                                       
                                        <RowDefinition Height="*" />                                      
                                    </Grid.RowDefinitions>

                                    <Grid Grid.Row="0">

                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Date -->
                                        <DatePicker 
                                            x:Name="ForDatePicker"
                                            Grid.Column="0"
                                        
                                            SelectedDate="{Binding FilterDate, Mode=TwoWay}" 
                                            materialDesign:HintAssist.Hint="{Binding ForDatePickerHint}"
                                            Style="{StaticResource MaterialDesignFilledDatePicker}" Margin="0,0,8,0"/>

                                        <!-- Checkbox -->
                                        <CheckBox Grid.Column="1"
                                            Content="{Binding ShowCanceledCheckBoxContent}"
                                            IsChecked="{Binding ShowCanceled}" 
                                            Style="{StaticResource MaterialDesignCheckBox}" Margin="0,0,8,0" VerticalAlignment="Center"/>

                                        <!-- Buttons -->
                                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                                            <Button 
                                                    ToolTip="{Binding ImportButtonToolTip}"
                                                    Command="{Binding ImportCommand}"
                                                    Style="{StaticResource MaterialDesignToolForegroundButton}" Margin="0,0,10,0" Click="Button_Click">
                                                <materialDesign:PackIcon Kind="DatabaseImport" Width="25" Height="25" Foreground="{DynamicResource MaterialDesign.Brush.Primary}"/>
                                            </Button>

                                            <Button  
                                                ToolTip="{Binding ExportButtonToolTip}"
                                                Command="{Binding ExportCommand}"
                                                Style="{StaticResource MaterialDesignToolForegroundButton}">
                                                <materialDesign:PackIcon Kind="MicrosoftExcel" Width="25" Height="25" Foreground="Green"/>
                                            </Button>
                                        </StackPanel>
                                    </Grid>

                                    <Grid Grid.Row="1" Margin="0 5 0 0">
                                        <TextBlock Text="{Binding GridSummary}" FontWeight="Bold"/>

                                    </Grid>
                                    
                                </Grid>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- Trip Data Area-->                       

                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*" />
                            <ColumnDefinition Width="7*" />
                            </Grid.ColumnDefinitions>


                            <!-- ForDateCalendar -->

                            <!-- Adjusted calendar -->
                            <Calendar x:Name="ForDateCalendar" Visibility="Collapsed"
                                  Grid.Column="0"
                                  SelectedDate="{Binding FilterDate, Mode=TwoWay}"
                                  VerticalAlignment="Center"
                                  HorizontalAlignment="Center"
                                  Margin="0"
                                  materialDesign:ElevationAssist.Elevation="Dp2"
                                  >     
                                <Calendar.LayoutTransform>
                                    <ScaleTransform ScaleX="0.75" ScaleY="0.685"/>
                                </Calendar.LayoutTransform>
                            </Calendar>

                            <!-- Trips TabControl -->
                        
                            <TabControl x:Name="TripTabs" Grid.Column="1" Visibility="Collapsed"
                                    MinHeight="240"
                                    MaxHeight="240"
                                    HorizontalContentAlignment="Left"
                                
                                    materialDesign:NavigationRailAssist.ShowSelectionBackground="True"
                                
                                    TabStripPlacement="Top"
                                    materialDesign:NavigationRailAssist.SelectionCornerRadius="50 10 10 10">
                                <!-- Tab 1: Location and Time -->
                                <TabItem Header="{Binding TripTabsTabItem1Header}" >
                                    <Grid Margin="0,0,2,0" >
                                        
                                    <Grid.Background>
                                        <RadialGradientBrush GradientOrigin="0.5,0.5" 
                                            Center="0.5,0.5" 
                                            RadiusX="0.5" 
                                            RadiusY="0.5">  
                                            <GradientStop Color="#FFFFFFFF" Offset="0.0"/>
                                            <!-- Blanco (100% opaco) -->
                                            <GradientStop Color="#D3FFD6" Offset="0.94"/>
                                            <!-- Verde en 94% -->
                                            <GradientStop Color="#D3FFD6" Offset="1.0"/>
                                            <!-- Verde en 100% -->
                                        </RadialGradientBrush>
                                    </Grid.Background>
                                        
                                    <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="6*" />
                                            <ColumnDefinition Width="4*" />
                                        </Grid.ColumnDefinitions>

                                    <Grid.RowDefinitions>
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                        </Grid.RowDefinitions>

                                    <!-- Left column -->

                                    <Button x:Name="InverterFloatingButton" Width="30" Height="30"
                                        Panel.ZIndex="100"
                                        Margin="12,9,16,-17"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Bottom"
                                        ToolTip="{Binding InverterFloatingButtonToolTip}"
                                        Style="{StaticResource MaterialDesignFloatingActionMiniButton}" Click="InverterFloatingButton_Click" >
                                        <materialDesign:PackIcon x:Name="InverterIcon" Kind="AutorenewOff" />


                                    </Button>
                                        
                                    <TextBox
                                            x:Name="PickupAddressTextBox" Grid.Row="0" Grid.Column="0" Margin="0,3,0,2"
                                            Text="{Binding SelectedCustomer.Address}"
                                            materialDesign:HintAssist.Hint="{Binding PickupAddressTextBoxHint}"                                                    
                                            materialDesign:TextFieldAssist.HasClearButton="True"
                                            materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                            materialDesign:TextFieldAssist.LeadingIcon="HomeMapMarker"
                                            Style="{StaticResource MaterialDesignFilledTextBox}" 
                                            TextChanged="GooglePlacesInput_TextChanged"/>

                                        <TextBox
                                            x:Name="DropoffAddressTextBox" Grid.Row="1" Grid.Column="0" Margin="0,0,0,2"
                                            Text="{Binding DropoffAddress}"
                                            materialDesign:HintAssist.Hint="{Binding DropoffAddressTextBoxHint}"                                                    
                                            materialDesign:TextFieldAssist.HasClearButton="True"
                                            materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                            materialDesign:TextFieldAssist.LeadingIcon="MapMarkerCheck"
                                            Style="{StaticResource MaterialDesignFilledTextBox}" 
                                            TextChanged="DropoffAddressTextBox_TextChanged"/>

                                    <Button x:Name="SaveTab1FloatingButton" Width="30" Height="30" Grid.Row="2" Grid.Column="0"
                                        Panel.ZIndex="100"
                                        Margin="12,19,16,-17"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Bottom"
                                        ToolTip="{Binding SaveTab1FloatingButtonToolTip}"
                                        Command="{Binding SaveTripCommand}"
                                        Style="{StaticResource MaterialDesignFloatingActionMiniButton}" Click="SaveTab1FloatingButton_Click">
                                        <materialDesign:PackIcon  Kind="ContentSave" />


                                    </Button>


                                        <StackPanel HorizontalAlignment="Center" Orientation="Horizontal" Grid.Row="2" Grid.Column="0" Margin="0,10,10,5">
                                            <RadioButton x:Name="RoundTripRadioButton" Content="{Binding RoundTripRadioButtonContent}" GroupName="TripType" Margin="0,0,10,0" Checked="RoundTripRadioButton_Checked"/>
                                            <RadioButton x:Name="OneWayRadioButton" Content="{Binding OneWayRadioButtonContent}" GroupName="TripType" Checked="OneWayRadioButton_Checked"/>
                                        </StackPanel>

                                        <StackPanel HorizontalAlignment="Center" Orientation="Horizontal" Grid.Row="3" Grid.Column="0" Margin="0,10,10,5">
                                            <RadioButton x:Name="AppointmentRadioButton" Content="{Binding AppointmentRadioButtonContent}" GroupName="OneWayKind" Margin="0,0,10,0" Checked="AppointmentRadioButton_Checked"/>
                                            <RadioButton x:Name="ReturnRadioButton" Content="{Binding ReturnRadioButtonContent}" GroupName="OneWayKind" Checked="ReturnRadioButton_Checked"/>
                                        </StackPanel>

                                        <!-- Right column -->                                   

                                        <materialDesign:TimePicker Grid.Row="0" Grid.Column="1"
                                            x:Name="PickupTimePicker"
                                            SelectedTime="{Binding PickupTimePicker, Mode=TwoWay}"
                                            VerticalAlignment="Bottom"
                                            Margin="10,0,0,0"
                                            materialDesign:HintAssist.Hint="{Binding PickupTimePickerHint}"
                                            materialDesign:TextFieldAssist.HasClearButton="True"
                                            materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                            materialDesign:TextFieldAssist.LeadingIcon="ClockTimeFour"
                                            Style="{StaticResource MaterialDesignFilledTimePicker}"
                                            Is24Hours="False"/>

                                        <materialDesign:TimePicker Grid.Row="1" Grid.Column="1"
                                            x:Name="ApptTimePicker"
                                            SelectedTime="{Binding ApptTimePicker, Mode=TwoWay}"              
                                            VerticalAlignment="Bottom"
                                            Margin="10,0,0,0"
                                            materialDesign:HintAssist.Hint="{Binding ApptTimePickerHint}"
                                            materialDesign:TextFieldAssist.HasClearButton="True"
                                            materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                            materialDesign:TextFieldAssist.LeadingIcon="CalendarClock"
                                            Style="{StaticResource MaterialDesignFilledTimePicker}"
                                            Is24Hours="False"/>

                                        <materialDesign:TimePicker Grid.Row="2" Grid.Column="1"
                                            x:Name="ReturnTimePicker"
                                            SelectedTime="{Binding ReturnTimePicker, Mode=TwoWay}" 
                                            VerticalAlignment="Bottom"
                                            Margin="10,0,0,0"
                                            materialDesign:HintAssist.Hint="{Binding ReturnTimePickerHint}"
                                            materialDesign:TextFieldAssist.HasClearButton="True"
                                            materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                            materialDesign:TextFieldAssist.LeadingIcon="ClockAlert"
                                            Style="{StaticResource MaterialDesignFilledTimePicker}"
                                            Is24Hours="False"/>

                                        <StackPanel Orientation="Horizontal" Grid.Row="3" Grid.Column="1" Margin="10,10,0,5">
                                            <CheckBox x:Name="WillCallCheckBox" Content="Will Call"/>
                                        </StackPanel>
                                    </Grid>
                                </TabItem>

                                <!-- Tab 2: Space Type -->
                                <TabItem Header="{Binding TripTabsTabItem2Header}">
                                    <Grid Margin="0" >

                                    <Grid.Background>
                                        <RadialGradientBrush GradientOrigin="0.5,0.5" 
                                            Center="0.5,0.5" 
                                            RadiusX="0.5" 
                                            RadiusY="0.5">          
                                            <GradientStop Color="#FFFFFFFF" Offset="0.0"/>
                                            <!-- Blanco (100% opaco) -->
                                            <GradientStop Color="#D1ECF8" Offset="0.94"/>
                                            <!-- Verde en 94% -->
                                            <GradientStop Color="#D1ECF8" Offset="1.0"/>
                                            <!-- Verde en 100% -->
                                        </RadialGradientBrush>
                                    </Grid.Background>
                                    <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*" />
                                            <ColumnDefinition Width="2*" />
                                        </Grid.ColumnDefinitions>

                                        <!-- ComboBox Space Type -->
                                        <StackPanel Grid.Column="0" VerticalAlignment="Top" Margin="0,0,00,0">

                                            <ComboBox   x:Name="TripSpaceTypeComboBox"
                                                ItemsSource="{Binding SpaceTypes}" 
                                                SelectedItem="{Binding SelectedSpaceType, Mode=TwoWay}" 
                                                DisplayMemberPath="ShowNameDescription" 
                                                SelectedValuePath="Id"
                                                Style="{StaticResource MaterialDesignFilledComboBox}"
                                                materialDesign:TextFieldAssist.HasClearButton="True"
                                                materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                materialDesign:TextFieldAssist.LeadingIcon="HumanWheelchair"
                                                Margin="0,0,0,2"
                                                materialDesign:HintAssist.Hint="{Binding TripSpaceTypeComboBoxHint}" />
                                        </StackPanel>

                                        <!-- DataGrid Additional Passengers -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Top">
                                            <TextBlock Text="Additional Passengers:" Margin="0,0,0,5"/>
                                            <DataGrid x:Name="AdditionalPassengersDataGrid" AutoGenerateColumns="False" Height="200">
                                                <DataGrid.Columns>
                                                    <DataGridTextColumn Header="Space" Binding="{Binding Space}" Width="*"/>
                                                    <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="2*"/>
                                                    <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="*"/>
                                                </DataGrid.Columns>
                                            </DataGrid>
                                        </StackPanel>
                                    </Grid>
                                </TabItem>

                                <!-- Tab 3: Pickup -->
                                <TabItem Header="{Binding TripTabsTabItem3Header}">
                                    <Grid Margin="0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="6*" />
                                            <ColumnDefinition Width="4*" />
                                        </Grid.ColumnDefinitions>

                                        <!-- Name and Phone -->
                                        <TextBox x:Name="PickupNameTextBox" Grid.Row="0" Grid.Column="0"
                                             Text="{Binding PickupName}"
                                             materialDesign:TextFieldAssist.HasClearButton="True"
 
                                             materialDesign:HintAssist.Hint="{Binding PickupNameTextBoxHint}"
                                             materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                             materialDesign:TextFieldAssist.LeadingIcon="TextUser"
                                             Style="{StaticResource MaterialDesignFilledTextBox}" Margin="0,0,0,2"/>

                                        <TextBox x:Name="PickupPhoneTextBox" Grid.Row="0" Grid.Column="1"
                                             Text="{Binding PickupPhone}"
                                             materialDesign:TextFieldAssist.HasClearButton="True"
 
                                             materialDesign:HintAssist.Hint="{Binding PickupPhoneTextBoxHint}"
                                             materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                             materialDesign:TextFieldAssist.LeadingIcon="Phone"
                                             Style="{StaticResource MaterialDesignFilledTextBox}" Margin="10,0,2,2"/>

                                        <!-- Comment -->
                                        <TextBox x:Name="PickupCommentTextBox" Grid.Row="1" Grid.ColumnSpan="2" 
                                                 Margin="2,10,4,2"
                                                 Text="{Binding PickupComment}"
                                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                                 AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                                                 materialDesign:HintAssist.Hint="{Binding PickupCommentTextBoxHint}"/>
                                    </Grid>
                                </TabItem>

                                <!-- Tab 4: Dropoff -->
                                <TabItem Header="{Binding TripTabsTabItem4Header}">
                                <Grid Margin="0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="6*" />
                                        <ColumnDefinition Width="4*" />
                                    </Grid.ColumnDefinitions>

                                    <!-- Name and Phone -->
                                    <TextBox x:Name="DropoffNameTextBox" Grid.Row="0" Grid.Column="0"
                                         Text="{Binding DropoffName}"
                                         materialDesign:TextFieldAssist.HasClearButton="True"
 
                                         materialDesign:HintAssist.Hint="Name"
                                         materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                         materialDesign:TextFieldAssist.LeadingIcon="TextUser"
                                         Style="{StaticResource MaterialDesignFilledTextBox}" Margin="0,0,0,2"/>

                                    <TextBox x:Name="DropoffPhoneTextBox" Grid.Row="0" Grid.Column="1"
                                         Text="{Binding DropoffPhone}"
                                         materialDesign:TextFieldAssist.HasClearButton="True"
 
                                         materialDesign:HintAssist.Hint="Phone"
                                         materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                         materialDesign:TextFieldAssist.LeadingIcon="Phone"
                                         Style="{StaticResource MaterialDesignFilledTextBox}" Margin="10,0,2,2"/>

                                    <!-- Comment -->
                                    <TextBox x:Name="DropoffCommentTextBox" Grid.Row="1" Grid.ColumnSpan="2" 
                                         Margin="2,10,4,2"
                                             Text="{Binding DropoffComment}"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                                         materialDesign:HintAssist.Hint="Comment"/>
                                    
                                </Grid>
                            </TabItem>

                            </TabControl>

                        </Grid>


                    </Grid>

                <!-- Vertical GridSplitter -->
                    <GridSplitter Grid.Column="1"
                                  Width="6"
                                  HorizontalAlignment="Stretch"
                                  VerticalAlignment="Stretch"
                                  Background="#40CCCCCC"
                                  ShowsPreview="True"
                                  Cursor="SizeWE">
                        
                    </GridSplitter>
                    
                <!-- Panel Billing (initially hidden) -->
                <Border  Grid.Column="2" BorderThickness="1,1,1,1" BorderBrush="{StaticResource MainBorderBrush}">
                    <StackPanel Grid.Column="2" x:Name="BillingPanel"
                                Visibility="Hidden"
                                Margin="10"
                                
                                Background="Transparent">

                    
                        <TabControl  
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Stretch"
                                HorizontalContentAlignment="Stretch"
                                VerticalContentAlignment="Stretch">

                            <TabItem x:Name="BillingSectionTabItem" Header="{Binding TextHeaderBillingSection}">

                                <TabControl  
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch"
                                    HorizontalContentAlignment="Stretch"
                                    VerticalContentAlignment="Stretch">

                                    <TabItem x:Name="ChargesTabItem" Header="{Binding Charges}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                        </Grid.RowDefinitions>
                                    
                                        <StackPanel Grid.Row="0" Margin="5 10 0 5" Orientation="Horizontal">
                                            <TextBlock Text="{Binding TotalTripChargeTextLabel}" Margin="0 0 0 0" FontWeight="Bold" Foreground="Green"/>
                                            <TextBlock Text=": " Margin="0 0 8 0" FontWeight="Bold" Foreground="Green"/>
                                            <TextBlock Text="{Binding TotalTripCharge}" Margin="0 0 40 0" FontWeight="Bold" Foreground="Green"/>
                                            <TextBlock x:Name="TripTypeTextBlock" Text="{Binding TripType}" Margin="0 0 8 0" FontWeight="Bold"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Row="1" Margin="5 10 0 0" Orientation="Horizontal">
                                            <TextBlock Text="{Binding DistanceTextLabel}" Margin="0 0 0 0" FontWeight="Bold"/>
                                            <TextBlock Text=": " Margin="0 0 8 0" FontWeight="Bold" />
                                            <TextBlock Text="{Binding Distance}" Margin="0 0 8 0" FontWeight="Bold"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Row="2"
                                            Orientation="Horizontal" Margin="10,10,0,0"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center">
                                            
                                            <RadioButton x:Name="ImportedRadioButton" Content="{Binding Imported}"
                                                 GroupName="OriginRadioButtonGroup"
                                                 IsChecked="{Binding OriginImported}" 
                                                 Style="{StaticResource MaterialDesignRadioButton}" Margin="0,0,10,0"/>     
                                            <RadioButton x:Name="RoutedRadioButton" Content="{Binding Routed}"
                                                 GroupName="OriginRadioButtonGroup"
                                                 IsChecked="{Binding OriginRouted}" 
                                                 Style="{StaticResource MaterialDesignRadioButton}"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Row="3" Margin="5 10 0 5" Orientation="Horizontal">
                                            <TextBlock Text="{Binding SelectedChargesTextLabel}" Margin="0 0 15 0" FontWeight="Bold"/>
                                            <CheckBox x:Name="AllowUdateCheckBox" Content="{Binding AllowUpdateText}"/>
                                        </StackPanel>
                                        
                                        <Border Grid.Row="4" BorderThickness="1,1,1,1" 
                                                BorderBrush="{StaticResource MainBorderBrush}"
                                                Background="White">

                                            <Grid Margin="4"
                                                VerticalAlignment="Stretch"
                                                HorizontalAlignment="Stretch">

                                                <!-- DATAGRID -->
                                                <DataGrid x:Name="SelectedChargesDataGrid"          
                                                      ItemsSource="{Binding SelectedCharges}"                                                      
                                                      SelectionMode="Single"
                                                      AutoGenerateColumns="False"
                                                      IsReadOnly="True"
                                                      AlternationCount="2"
                                                      AlternatingRowBackground="White"   
          
                                                      Style="{StaticResource CustomDataGridStyle}"
                                                      ColumnHeaderStyle="{StaticResource CustomColumnHeaderStyle}"
                                                      RowStyle="{StaticResource CustomRowStyle}"
                                                      CellStyle="{StaticResource CustomCellStyle}"
                                                      SelectionUnit="FullRow">

                                                    <DataGrid.Columns>
                                                        
                                                        <DataGridTextColumn 
                                                            Binding="{Binding BillingItem.Description}"
                                                            Header="{Binding Data.ChargesDescriptionText, Source={StaticResource vmProxy}}"/>
                                                        
                                                        <DataGridTextColumn 
                                                            Binding="{Binding Rate}"
                                                            Header="{Binding Data.ChargesRateText, Source={StaticResource vmProxy}}"/>

                                                        <DataGridTextColumn 
                                                            Binding="{Binding Qty}"
                                                            Header="{Binding Data.ChargesQtyText, Source={StaticResource vmProxy}}"/>

                                                        <DataGridTextColumn 
                                                            Binding="{Binding Per}"
                                                            Header="{Binding Data.ChargesPerText, Source={StaticResource vmProxy}}"/>

                                                        <DataGridTextColumn 
                                                            Binding="{Binding ProcedureCode}"
                                                            Header="{Binding Data.ChargesProcedureCodeText, Source={StaticResource vmProxy}}"/>

                                                        <DataGridTextColumn 
                                                            Binding="{Binding Cost}"
                                                            Header="{Binding Data.ChargesCostText, Source={StaticResource vmProxy}}"/>

                                                    </DataGrid.Columns>
                                                    
                                                </DataGrid>

                                            </Grid>

                                        </Border>

                                        <Grid Grid.Row="5" Margin="2 10 2 10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <!-- Left Column -->
                                            <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                                <ComboBox x:Name="FundingSourceBillingComboBox"
                                                    ItemsSource="{Binding FundingSources}" 
                                                    SelectedItem="{Binding SelectedFundingSource, Mode=TwoWay}" 
                                                    DisplayMemberPath="Name" 
                                                    SelectedValuePath="Id"
                                                    Style="{StaticResource MaterialDesignFilledComboBox}"
                                                    materialDesign:TextFieldAssist.HasClearButton="True"
                                                    materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                    materialDesign:TextFieldAssist.LeadingIcon="Finance"
                                                    Margin="0,0,0,2"
                                                    materialDesign:HintAssist.Hint="{Binding FundingSourceText}" />  

                                            </StackPanel>

                                            <!-- Right Column -->
                                            <StackPanel Grid.Column="1">
                                                <TextBox x:Name="BillingAuthorization" Text="{Binding Authorization}" 
                                                     materialDesign:HintAssist.Hint="{Binding AuthorizationText}" 
                                                     materialDesign:TextFieldAssist.HasClearButton="True"
                                                     materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                                     materialDesign:TextFieldAssist.LeadingIcon="KeyVariant"
                                                     Style="{StaticResource MaterialDesignFilledTextBox}" Margin="0,0,0,2"/>
                                            </StackPanel>

                                        </Grid>

                                        <StackPanel Grid.Row="6" Margin="5 10 0 5" Orientation="Horizontal">
                                            <TextBlock Text="{Binding NonDefaultChargesTextLabel}" Margin="0 0 0 0" FontWeight="Bold"/>
                                            
                                        </StackPanel>

                                        <Border Grid.Row="7" BorderThickness="1,1,1,1" 
                                            BorderBrush="{StaticResource MainBorderBrush}"
                                            Background="White">

                                            <Grid Margin="4"
                                                VerticalAlignment="Stretch"
                                                HorizontalAlignment="Stretch">

                                                <!-- DATAGRID -->
                                                <DataGrid x:Name="NonDefaultChargesDataGrid"          
                                                      ItemsSource="{Binding NonDefaultCharges}"                                                      
                                                      SelectionMode="Single"
                                                      AutoGenerateColumns="False"
                                                      IsReadOnly="True"
                                                      AlternationCount="2"
                                                      AlternatingRowBackground="White"   
          
                                                      Style="{StaticResource CustomDataGridStyle}"
                                                      ColumnHeaderStyle="{StaticResource CustomColumnHeaderStyle}"
                                                      RowStyle="{StaticResource CustomRowStyle}"
                                                      CellStyle="{StaticResource CustomCellStyle}"
                                                      SelectionUnit="FullRow">

                                                    <DataGrid.Columns>

                                                        <DataGridTextColumn 
                                                            Binding="{Binding BillingItem.Description}"
                                                            Header="{Binding Data.ChargesDescriptionText, Source={StaticResource vmProxy}}"/>   

                                                        <DataGridTextColumn 
                                                            Binding="{Binding Rate}"
                                                            Header="{Binding Data.ChargesRateText, Source={StaticResource vmProxy}}"/>

                                                        <DataGridTextColumn 
                                                            Binding="{Binding Per}"
                                                            Header="{Binding Data.ChargesPerText, Source={StaticResource vmProxy}}"/>

                                                        <DataGridCheckBoxColumn Binding="{Binding IsDefault}"
                                                            Header="{Binding Data.IsDefaultText, Source={StaticResource vmProxy}}"                       
                                                            IsReadOnly="True"/>
                                                        
                                                        <DataGridTextColumn 
                                                            Binding="{Binding ProcedureCode}"
                                                            Header="{Binding Data.ChargesProcedureCodeText, Source={StaticResource vmProxy}}"/>

                                                    </DataGrid.Columns>

                                                </DataGrid>

                                            </Grid>

                                        </Border>

                                    </Grid>
                                    
                                </TabItem>
                                
                                    <TabItem x:Name="HistoryTabItem" Header="{Binding History}">

                                    </TabItem>
                                    <TabItem x:Name="SignatureTabItem" Header="{Binding Signature}">

                                    </TabItem>


                                </TabControl>
                                
                            </TabItem>

                        </TabControl>
                        
                    
                        
                </StackPanel>

                </Border>
                    
                <!-- Vertical GridSplitter -->
                    <GridSplitter Grid.Column="3" x:Name="BillingGridSplitter"
                                  Width="6"
                                  HorizontalAlignment="Stretch"
                                  VerticalAlignment="Stretch"
                                  Background="#40CCCCCC"
                                  ShowsPreview="True"
                                  Cursor="SizeWE">
                        
                    </GridSplitter>

                    <!-- WebView2 con el mapa -->
                    <wv2:WebView2 Grid.Column="4" x:Name="MapaWebView" Loaded="WebView_Loaded" />
                </Grid>

                <!-- Horizontal GridSplitter -->
                <GridSplitter Grid.Row="1" x:Name="GridRow1"
                      Height="6"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      Background="#40CCCCCC"
                      ShowsPreview="True"
                      Cursor="SizeNS">
                    <!--<GridSplitter.Template>
                        <ControlTemplate TargetType="GridSplitter">
                            <Grid Background="{TemplateBinding Background}">
                                <Rectangle Fill="#808080" Height="2" VerticalAlignment="Center" RadiusX="1" RadiusY="1" />
                            </Grid>
                        </ControlTemplate>
                    </GridSplitter.Template>-->
                </GridSplitter>

                <!-- Bottom DataGrid -->


            <Grid Grid.Row="2" x:Name="GridRow2">
                <!-- DATAGRID -->
                <DataGrid                            
                    ItemsSource="{Binding TripsByDate}" 
                    SelectedItem="{Binding SelectedTrip, Mode=TwoWay}"                                  
                            
                    SelectionMode="Single"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    AlternationCount="2"
                    AlternatingRowBackground="White"
                                   
                    Style="{StaticResource CustomDataGridStyle}"
                    ColumnHeaderStyle="{StaticResource CustomColumnHeaderStyle}"
                    
                    RowStyle="{StaticResource HomeTripRowStyle}"
                    CellStyle="{StaticResource CustomCellStyle}"
                    SelectionUnit="FullRow">

                    <DataGrid.Columns>

                        <DataGridTemplateColumn Width="Auto">
                            <DataGridTemplateColumn.HeaderTemplate>
                                <DataTemplate>
                                    <Button Command="{Binding DataContext.FilterSettingsCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            Style="{StaticResource MaterialDesignToolButton}">
                                        <materialDesign:PackIcon Kind="FilterSettings" Width="20" Height="20"/>
                                    </Button>
                                </DataTemplate>
                            </DataGridTemplateColumn.HeaderTemplate>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">

                                        

                                        <!-- Cancel Button (Visible if not canceled) -->
                                        <Button Command="{Binding DataContext.CancelTripCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Style="{StaticResource MaterialDesignToolButton}"
                                            ToolTip="Cancel Trip">
                                            <Button.Visibility>
                                                <Binding Path="Status" Converter="{StaticResource StatusToVisibilityConverter}" ConverterParameter="NotCanceled" />
                                            </Button.Visibility>
                                            <materialDesign:PackIcon Kind="CloseThick" Foreground="Red" Width="20" Height="20" />
                                        </Button>

                                        <!-- Restore Button (Visible if YES is cancelled) -->
                                        <Button Command="{Binding DataContext.UncancelTripCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Style="{StaticResource MaterialDesignToolButton}"
                                            ToolTip="Uncancel trip">
                                            <Button.Visibility>
                                                <Binding Path="Status" Converter="{StaticResource StatusToVisibilityConverter}" ConverterParameter="Canceled" />
                                            </Button.Visibility>
                                            <materialDesign:PackIcon Kind="Restore" Foreground="Green" Width="20" Height="20" />
                                        </Button>

                                        <!-- Edit button -->
                                        <Button Command="{Binding DataContext.EditTripCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Style="{StaticResource MaterialDesignToolButton}"
                                            ToolTip="Edit Trip">
                                            <materialDesign:PackIcon Kind="FileEdit" Foreground="Orange"/>
                                        </Button>

                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>


                        <DataGridTextColumn Binding="{Binding Day}"
                                        Header="{Binding Data.DayText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding Date}"
                                        Header="{Binding Data.DateText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding FromTime}"
                                        Header="{Binding Data.FromTimeText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding ToTime}"
                                        Header="{Binding Data.ToTimeText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding CustomerName}"
                                        Header="{Binding Data.CustomerNameText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding PickupAddress}"
                                        Header="{Binding Data.PickupAddressText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding DropoffAddress}"
                                        Header="{Binding Data.DropoffAddressText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding SpaceTypeName}"
                                        Header="{Binding Data.SpaceTypeNameText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding Charge}"
                                        Header="{Binding Data.ChargeText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding Paid}"
                                        Header="{Binding Data.PaidText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding PickupComment}"
                                        Header="{Binding Data.PickupCommentText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding DropoffComment}"
                                        Header="{Binding Data.DropoffCommentText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding Type}"
                                        Header="{Binding Data.TypeText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding Pickup}"
                                        Header="{Binding Data.PickupText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding Dropoff}"
                                        Header="{Binding Data.DropoffText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding PickupPhone}"
                                        Header="{Binding Data.PickupPhoneText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding DropoffPhone}"
                                        Header="{Binding Data.DropoffPhoneText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding TripId}"
                                        Header="{Binding Data.TripIdText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding Authorization}"
                                        Header="{Binding Data.AuthorizationText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding FundingSourceName}"
                                        Header="{Binding Data.FundingSourceText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding Distance}"
                                        Header="{Binding Data.DistanceText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding RunName}"
                                        Header="{Binding Data.RunText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding PickupCity}"
                                        Header="{Binding Data.PickupCityText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding DropoffCity}"
                                        Header="{Binding Data.DropoffCityText, Source={StaticResource vmProxy}}"/>

                        <DataGridTextColumn Binding="{Binding DriverNoShowReason}"
                                        Header="{Binding Data.DriverNoShowReasonText, Source={StaticResource vmProxy}}"/>


                </DataGrid.Columns>

                </DataGrid>
                
                <Border Background="#80FFFFFF" 
                    Visibility="{Binding IsLoadingTrips, Converter={StaticResource BoolToVisibility}}">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <ProgressBar IsIndeterminate="True"
                         Style="{StaticResource MaterialDesignCircularProgressBar}"
                         Width="50" Height="50" />
                        <TextBlock Text="Loading trips and locations..."
                       Margin="0,15,0,0"
                       FontSize="16"
                       FontWeight="Bold" />
                    </StackPanel>
                </Border>

            </Grid>



        <!--<DataGrid Grid.Row="2" x:Name="GridRow2"
                          ItemsSource="{Binding TripsByDate}" 
                          SelectedItem="{Binding SelectedTrip, Mode=TwoWay}"
                          AutoGenerateColumns="false" SelectionMode="Single">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Day" Binding="{Binding Day}"/>
                    <DataGridTextColumn Header="Date" Binding="{Binding Date}"/>
                    <DataGridTextColumn Header="From Time" Binding="{Binding FromTime}"/>
                    <DataGridTextColumn Header="To Time" Binding="{Binding ToTime}"/>
                    <DataGridTextColumn Header="Patient" Binding="{Binding CustomerName}"/>
                    <DataGridTextColumn Header="Pickup Address" Binding="{Binding PickupAddress}"/>
                    <DataGridTextColumn Header="Dropoff Address" Binding="{Binding DropoffAddress}"/>
                    <DataGridTextColumn Header="Space" Binding="{Binding SpaceTypeName}"/>
                    <DataGridTextColumn Header="Charge" Binding="{Binding Charge}"/>
                    <DataGridTextColumn Header="Paid" Binding="{Binding Paid}"/>
                    <DataGridTextColumn Header="Pickup Comment" Binding="{Binding PickupComment}"/>
                </DataGrid.Columns>
            </DataGrid>-->


            <!-- Import Trips-->
                <Grid Grid.Row="0" x:Name="ImportTripsGridRow" Visibility="Collapsed" Margin="10">
                    <StackPanel>
                    <ComboBox x:Name="FundingSourceImportComboBox"
                        ItemsSource="{Binding FundingSources}" 
                        SelectedItem="{Binding SelectedFundingSourceImport, Mode=TwoWay}" 
                        DisplayMemberPath="Name" 
                        SelectedValuePath="Id"
                        Style="{StaticResource MaterialDesignFilledComboBox}"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        materialDesign:TextFieldAssist.HasLeadingIcon="True"
                        materialDesign:TextFieldAssist.LeadingIcon="Finance"
                        Margin="0,0,0,10"
                        materialDesign:HintAssist.Hint="{Binding FundingSourceComboBoxHint}" />

                    <Button Content="{Binding SelectCsvButtonContent}" Click="SelectCsv_Click" Margin="0 0 0 10" x:Name="SelectCsvButton"/>

                        <!-- Contenedor para la barra de progreso y el texto -->
                        <StackPanel Margin="0,5,0,10" x:Name="ProgressPanel" Visibility="Collapsed">
                            <TextBlock x:Name="ProgressText" Text="{Binding ProgressPanelText}" HorizontalAlignment="Center"/>
                            <ProgressBar x:Name="ImportProgressBar" Height="20" Margin="0,5,0,0" IsIndeterminate="False"/>
                        </StackPanel>

                        <DataGrid x:Name="PreviewGrid" AutoGenerateColumns="True" Height="350" Margin="0,10,0,0"/>
                    </StackPanel>
                </Grid>
                
            <!-- Import Trips-->
                <!--<Grid Grid.Row="0" x:Name="ImportTripsGridRow" Visibility="Collapsed" Margin="10">
                    <StackPanel>
                        <Button Content="Seleccionar archivo CSV" Click="SelectCsv_Click" Margin="0 0 0 10"/>
                        <DataGrid x:Name="PreviewGrid" AutoGenerateColumns="True" Height="350"/>
                    </StackPanel>
                </Grid>-->
        
            
            </Grid>

        </Border>

    </materialDesign:DialogHost>
    
</UserControl>
